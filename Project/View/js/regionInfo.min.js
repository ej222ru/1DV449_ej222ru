"use strict";function setupRegionSelectBox(){$(document).ready(function(){$("#RegionId").multiselect({buttonText:function(e,t){if(0===e.length)return"Välj kommuner ";if(e.length>3){var a=$("#RegionId option").filter(function(){return!$(this).is(":selected")});a.each(function(){var e=$('input[value="'+$(this).val()+'"]');e.prop("disabled",!0),e.parent("li").addClass("disabled")})}else $("#RegionId option").each(function(){var e=$('input[value="'+$(this).val()+'"]');e.prop("disabled",!1),e.parent("li").addClass("disabled")});var n=[];return e.each(function(){void 0!==$(this).attr("label")?n.push($(this).attr("label")):n.push($(this).html())}),n.join(", ")+""}})})}function setupCriteriaSelectBox(){$(document).ready(function(){$("#CriteriaId").multiselect({buttonText:function(e,t){if(0===e.length)return"Välj jämförelsetal ";if(e.length>3){var a=$("#CriteriaId option").filter(function(){return!$(this).is(":selected")});a.each(function(){var e=$('input[value="'+$(this).val()+'"]');e.prop("disabled",!0),e.parent("li").addClass("disabled")})}else $("#CriteriaId option").each(function(){var e=$('input[value="'+$(this).val()+'"]');e.prop("disabled",!1),e.parent("li").addClass("disabled")});var n=[];return e.each(function(){void 0!==$(this).attr("label")?n.push($(this).attr("label")):n.push($(this).html())}),n.join(", ")+""}})})}function getItem(e,t){var a=document.getElementsByName("Region[]"),n=document.getElementsByName("Criteria[]"),r="",i=0;if("Region"==e)for(var l=0;l<a[0].childElementCount;l++)a[0][l].selected&&(i++,i==t&&(r=a[0][l].value));else if("Criteria"==e)for(var l=0;l<n[0].childElementCount;l++)n[0][l].selected&&(i++,i==t&&(r=n[0][l].value));return r}function getSelectedItems(e){var t=document.getElementsByName("Region[]"),a=document.getElementsByName("Criteria[]"),n=0;if("Region"==e)for(var r=0;r<t[0].childElementCount;r++)t[0][r].selected&&n++;else if("Criteria"==e)for(var r=0;r<a[0].childElementCount;r++)a[0][r].selected&&n++;return n}function getBarChartTypeInfo(e,t){var a="";return"Region"==e?t<=getSelectedItems("Region")&&(a=getItem("Region",t)):"Criteria"==e&&t<=getSelectedItems("Criteria")&&(a=getItem("Criteria",t)),a}function getBarChartLabels(e){var t="";return t=2*(e+1)-getSelectedItems("Criteria")==1?[getBarChartTypeInfo("Criteria",1+2*e)]:[getBarChartTypeInfo("Criteria",1+2*e),getBarChartTypeInfo("Criteria",2+2*e)]}function getBarChartYAxis(e){return e%2==1?"y-axis-1":"y-axis-2"}function getBarChartColor(e){return 1==e?"rgba(255,0,0,0.5)":2==e?"rgba(86,66,232,0.5)":3==e?"rgba(20,255,0,0.5)":void 0}function getBarChartValue(e,t){var a="";return e<=getSelectedItems("Region")&&t<=getSelectedItems("Criteria")&&(a=t%2==1?[localStorage[getItem("Region",e)+getItem("Criteria",t)],0]:[0,localStorage[getItem("Region",e)+getItem("Criteria",t)]]),a}function setupChartDataset(e,t){return{label:getBarChartTypeInfo("Region",e),backgroundColor:getBarChartColor(e),yAxisID:getBarChartYAxis(t),data:getBarChartValue(e,t)}}function setupBarChart(){document.getElementById("chartContainer").innerHTML="&nbsp;",document.getElementById("chartContainer").innerHTML='<canvas id="myChart1"></canvas><canvas id="myChart2"></canvas>';for(var e=getSelectedItems("Criteria")/2,t=0;e>t;t++){var a,n=1+2*t,r=2+2*t,i={labels:getBarChartLabels(t),datasets:[setupChartDataset(1,n),setupChartDataset(2,n),setupChartDataset(3,n),setupChartDataset(4,n),setupChartDataset(1,r),setupChartDataset(2,r),setupChartDataset(3,r),setupChartDataset(4,r)]};a=0==t?document.getElementById("myChart1").getContext("2d"):document.getElementById("myChart2").getContext("2d");var l;l=2*(t+1)-getSelectedItems("Criteria")==1?{yAxes:[{type:"linear",display:!0,position:"left",id:"y-axis-1"}]}:{yAxes:[{type:"linear",display:!0,position:"left",id:"y-axis-1"},{type:"linear",display:!0,position:"right",id:"y-axis-2",gridLines:{drawOnChartArea:!1}}]},Chart.Bar(a,{data:i,options:{responsive:!0,hoverMode:"label",hoverAnimationDuration:400,stacked:!1,scales:l}})}}function getRegionPosition(e){var t;switch(e){case"Botkyrka":t={lat:59.23,lng:17.82};break;case"Danderyd":t={lat:59.4,lng:18.07};break;case"Ekerö":t={lat:59.3,lng:17.85};break;case"Haninge":t={lat:59.1,lng:18.2};break;case"Huddinge":t={lat:59.23,lng:18};break;case"Järfälla":t={lat:59.43,lng:17.8};break;case"Nacka":t={lat:59.3,lng:18.25};break;case"Sollentuna":t={lat:59.43,lng:17.91};break;case"Solna":t={lat:59.36,lng:17.98};break;case"Stockholm":t={lat:59.325,lng:18.1};break;case"Sundbyberg":t={lat:59.368,lng:17.95};break;case"Tyresö":t={lat:59.245,lng:18.25};break;case"Täby":t={lat:59.44,lng:18.07};break;case"Upplands Väsby":t={lat:59.51,lng:17.925};break;case"Vallentuna":t={lat:59.5,lng:18.1};break;case"Värmdö":t={lat:59.3,lng:18.43};break;case"Österåker":t={lat:59.46,lng:18.35}}return t}function calcCenterPosition(e){for(var t=0,a=0,n=0,r=0,i="",l=function(e){void 0!=e&&(t+=e.lat,a+=e.lng,n++)},o=0;o<e.length;o++)l(e[o]);if(0!=n){var t=t/n,a=a/n;r='{ "lat":'+t+',"lng":'+a+"}",i=JSON.parse(r)}return i}function markRegionOnMap(){for(var e=[],t=[],a=1;a<=getSelectedItems("Region");a++)e.push(getBarChartTypeInfo("Region",a)),t.push(getRegionPosition(e[a-1])),addMarker(t[a-1],map,e[a-1],"","region");var n=calcCenterPosition(t);""!=n&&map.setCenter(n)}function refreshLocalStorage(){for(var e=document.getElementsByName("Region[]"),t=document.getElementsByName("Criteria[]"),a=0;a<t[0].childElementCount;a++)for(var n=0;n<e[0].childElementCount;n++)localStorage.clear(e[0][n].value+t[0][a].value)}function displayInfo(){var e=document.getElementById("displayInfo"),t=document.getElementById("Info");"Hide"==t.className?(t.className="Show",e.innerHTML="Stäng info"):(t.className="Hide",e.innerHTML="Info")}var map,myRegionInfo={init:function(e){document.getElementById("getSCB").addEventListener("click",getSCBData),document.getElementById("displayInfo").addEventListener("click",displayInfo),document.getElementById("refreshLocalStorage").addEventListener("click",refreshLocalStorage),setupRegionSelectBox(),setupCriteriaSelectBox();var t=localStorage.response;void 0===t?document.getElementById("chartContainer").className="Hide":setupBarChart(),map=initMap(),"Show"==document.getElementById("chartContainer").className&&markRegionOnMap(),attachCrimeCheckboxHandler()}};window.addEventListener("load",myRegionInfo.init());